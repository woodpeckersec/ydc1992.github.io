window._bd_share_main.F.module("view/image_view",function(e,t,i){var o=e("base/tangram").T,n=e("base/class").Class,s=e("conf/const"),a=e("view/view_base");t.View=n.create(function(e){function t(){var t=e.tag||"";o("img").each(function(e,a){if(!t||o(a).attr(s.CONFIG_TAG_ATTR)==t){if(1==o(a).attr("data-bd-imgshare-binded"))return;o(a).on("mouseenter",i).on("mouseleave",n),o(a).attr("data-bd-imgshare-binded",1)}})}function i(e){var t=e.target;a(t)&&(b.element=t,b.start())}function n(){b.abort()}function a(t){var i=!0;return e.bdMinHeight&&e.bdMinHeight>t.offsetHeight?i=!1:e.bdMinWidth&&e.bdMinWidth>t.offsetWidth?i=!1:(t.offsetWidth<100||t.offsetHeight<100)&&(i=!1),i}function r(t){if("list"==e.viewType)for(var i={16:{lbl:53,pright:8,item:18},24:{lbl:57,pright:8,item:28},32:{lbl:61,pright:8,item:38}}[e.viewSize],n=Math.floor((t.offsetWidth-i.lbl-i.pright-10)/i.item),s=c.find(".bdimgshare-icon"),a=0,r=s.length-1;a<r;a++)a<n-1?o(s[a]).show():o(s[a]).hide();var h={width:c.offsetWidth,height:c.offsetHeight},f={width:t.offsetWidth,height:t.offsetHeight},l=function(t,i,o){return"list"==e.viewType?{top:t.top+("bottom"==e.viewPos?i.height-o.height:0),left:t.left}:"collection"==e.viewType?{top:t.top+(e.viewPos.toLowerCase().indexOf("bottom")>-1?i.height-o.height-5:5),left:t.left+(e.viewPos.toLowerCase().indexOf("left")>-1?5:i.width-o.width-5)}:{top:t.top+("bottom"==e.viewPos?i.height-o.height:0),left:t.left+(i.width-o.width)}}(o(t).offset(),f,h),d={position:"absolute",top:l.top+"px",left:l.left+"px"};"list"==e.viewType&&(d.width=f.width+"px"),c.css(d)}function h(){var t=["<div id='#{id}' class='sr-bdimgshare sr-bdimgshare-#{type} sr-bdimgshare-#{size} sr-bdimgshare-#{color}' style='height:#{height}px;line-height:#{lineHeight}px;font-size:#{fontSize}px;width:#{width}px;display:none;'>","<div class='bdimgshare-bg'></div>","<div class='bdimgshare-content bdsharebuttonbox bdshare-button-style#{style}-#{size}'>","<label class='bdimgshare-lbl'>#{text}</label>","#{list}","</div>","</div>"].join(""),i="<a href='#' onclick='return false;' class='bds_#{icon}' data-cmd='#{icon}' hidefocus></a>",n="list"==e.viewType,s=[];n&&o.each(e.viewList,function(e,t){s.push(o.string(i).format({icon:t}))}),s.push(o.string(i).format({icon:"more"}));var a={16:"36",24:"42",32:"48"},r={16:"33",24:"39",32:"45"},h=o.string(t).format({id:d,text:e.viewText||(n?"图片分享":"分享"),type:e.viewType,style:e.viewStyle,size:e.viewSize,color:e.viewColor,width:n?"auto":{16:"60",24:"71",32:"82"}[e.viewSize],height:(n?a:r)[e.viewSize],lineHeight:(n?a:r)[e.viewSize]-10,fontSize:{16:"12",24:"14",32:"14"}[e.viewSize],list:s.join("")});o("body").insertHTML("beforeEnd",h),l._entities=c=o("#"+d),c.on("mouseleave",function(){b.abort()}).on("mouseenter",function(){b.clearAbort()})}function f(t){if(e.bdCustomStyle){var i=document.createElement("link");i.href=e.bdCustomStyle,i.rel="styleSheet",i.type="text/css",i.onLoad=function(){t&&t()},document.getElementsByTagName("head")[0].appendChild(i)}else window._bd_share_main.F.use(["imgshare.css","share_style0_"+e.viewSize+".css"],function(){t&&t()})}var l=this,d="bdimgshare_"+(new Date).getTime(),c=null,u=!1,m=null,b=new function(e){var t=this,i=!1,o=!1;t.clearAbort=function(){o&&(o=clearTimeout(o))},t.start=function(){o&&(o=clearTimeout(o)),i||(i=setTimeout(function(){e.startFn&&e.startFn(),i=!1},e.time))},t.abort=function(){i&&(i=clearTimeout(i)),o||(o=setTimeout(function(){e.abortFn&&e.abortFn(),o=!1},e.time))}}({time:200,startFn:function(){var e;(e=b.element)&&f(function(){r(e),c.show(),u=!1,m=e})},abortFn:function(){u||c.hide()}});l.render=function(e){t(),h()},l._init=function(){},l._keepBarVisible=function(){b.clearAbort(),u=!0},l._getImageSrc=function(){return m.src},l._distory=function(){c.remove();var t=e.tag||"";o("img").each(function(e,a){t&&o(a).attr(s.CONFIG_TAG_ATTR)!=t||(o(a).off("mouseenter",i).off("mouseleave",n),o(a).removeAttr("data-bd-imgshare-binded"))})}},a.ViewBase)});